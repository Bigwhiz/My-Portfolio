import{I as oe,J as ce,K as se,c as D,f as Z,k as j,m as Y,n as ee,p as te,q as re,u as ne,v as ae}from"/build/_shared/chunk-WSDDTCW4.js";import{a as Q}from"/build/_shared/chunk-UFO47Q2A.js";import{a as J}from"/build/_shared/chunk-DCJLI3GM.js";import{f as O,k as U,l as H}from"/build/_shared/chunk-CG2D626R.js";import{a as he,b as K}from"/build/_shared/chunk-GDLBX7ER.js";import{c as B}from"/build/_shared/chunk-Q3IECNXJ.js";var t=B(he(),1);var i={carousel:"VMfuy",content:"_3EbHu",imageWrapper:"Ip-dB",canvasWrapper:"_9srfA",canvas:"NZTS0",placeholder:"P-DcB",button:"MBfGb",nav:"_9nvIC",navButton:"_0Q4nb"};var a=B(K(),1);function ie(u,l,m,x){if(l!==null)return l;let y=m.length,I=(u-1+y)%y,P=(u+1)%y;return x>0?P:I}var xe=({width:u,height:l,images:m,placeholder:x,...y})=>{let[I,P]=(0,t.useState)(!1),[o,ue]=(0,t.useState)(0),[S,le]=(0,t.useState)(!1),[de,me]=(0,t.useState)(!0),[s,pe]=(0,t.useState)(),[L,ve]=(0,t.useState)(),M=(0,t.useRef)(),E=(0,t.useRef)(),z=(0,t.useRef)(),f=(0,t.useRef)(),g=(0,t.useRef)(),F=(0,t.useRef)(),c=(0,t.useRef)(),w=(0,t.useRef)(!1),C=(0,t.useRef)(),R=(0,t.useRef)(),W=(0,t.useRef)(),$=U(),q=J(M,!0),T=(0,t.useRef)(),G=(0,t.useRef)(),fe=`Slide ${o+1} of ${m.length}. ${m[o].alt}`;(0,t.useEffect)(()=>(I&&(document.body.style.cursor="grabbing"),()=>{document.body.style.cursor=""}),[I]),(0,t.useEffect)(()=>{let e=[u/-2,u/2,l/2,l/-2,1,1e3];return c.current=new ne({canvas:M.current,antialias:!1,alpha:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),F.current=new re(...e),g.current=new ae,c.current.setPixelRatio(2),c.current.setClearColor(1118481,1),c.current.setSize(u,l),c.current.domElement.style.width="100%",c.current.domElement.style.height="auto",g.current.background=new j(1118481),F.current.position.z=1,()=>{w.current=!1,ce(g.current),se(c.current)}},[l,u]),(0,t.useEffect)(()=>{let e=!0;return q&&!S&&(async()=>{let n=c.current.capabilities.getMaxAnisotropy(),p=m.map(async v=>{let k=v.srcSet?await Q(v):v.src,h=await oe.loadAsync(k);return await c.current.initTexture(h),h.colorSpace=Z,h.minFilter=D,h.magFilter=D,h.anisotropy=n,h.generateMipmaps=!1,h}),b=await Promise.all(p);e&&(f.current=new ee({uniforms:{dispFactor:{type:"f",value:0},direction:{type:"f",value:1},currentImage:{type:"t",value:b[0]},nextImage:{type:"t",value:b[1]},reduceMotion:{type:"b",value:$}},vertexShader:vertex,fragmentShader:fragment,transparent:!1,opacity:1}),z.current=new te(u,l,1),E.current=new Y(z.current,f.current),E.current.position.set(0,0,0),g.current.add(E.current),le(!0),pe(b),requestAnimationFrame(()=>{c.current.render(g.current,F.current)}))})(),()=>{e=!1}},[l,m,q,S,$,u]);let X=(0,t.useCallback)(({index:e,direction:r=1})=>{if(!s)return;ue(e);let{uniforms:n}=f.current;n.nextImage.value=s[e],n.direction.value=r;let p=()=>{n.currentImage.value=s[e],n.dispFactor.value=0,w.current=!1};n.dispFactor.value!==1&&(w.current=!0,H(n.dispFactor.value,1,{type:"spring",stiffness:100,damping:20,restSpeed:.001,restDelta:.001,onUpdate:b=>{n.dispFactor.value=b},onComplete:p}))},[s]),d=(0,t.useCallback)(({direction:e,index:r=null,...n})=>{if(!S)return;if(w.current){cancelAnimationFrame(W.current),W.current=requestAnimationFrame(()=>d({direction:e,index:r,...n}));return}let p=ie(o,r,s,e);X({index:p,direction:e,...n})},[X,o,S,s]),ge=(0,t.useCallback)(e=>{if(e===o)return;let r=e>o?1:-1;d({direction:r,index:e})},[o,d]);(0,t.useEffect)(()=>{let e=()=>{let r=M.current.getBoundingClientRect();ve(r)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}},[]),(0,t.useEffect)(()=>{let e,r=()=>{e=requestAnimationFrame(r),w.current&&c.current.render(g.current,F.current)};return e=requestAnimationFrame(r),()=>{cancelAnimationFrame(e)}},[]),(0,t.useEffect)(()=>{if(x){let e=()=>{me(!1)},r=T.current;return r.addEventListener("transitionend",e),()=>{r&&r.removeEventListener("transitionend",e)}}},[x]);let _=(0,t.useCallback)(e=>{if(w.current||!f.current||!s)return;R.current=e;let r=Math.abs(e),n=L.width;C.current=e>0?-1:1;let p=1-(r-n)/n*-1,b=ie(o,null,m,C.current),v=f.current.uniforms,k=Math.min(Math.max(p,0),1);v.currentImage.value=s[o],v.nextImage.value=s[b],v.direction.value=C.current,v.dispFactor.value=k,requestAnimationFrame(()=>{c.current.render(g.current,F.current)})},[L,o,m,s]),V=(0,t.useCallback)(()=>{if(!f.current)return;let e=f.current.uniforms,r=(1-e.dispFactor.value)*1e3,n=Math.abs(R.current),p=L.width*.2;R.current=0,!w.current&&(n===0||!n||(n>p?d({duration:r,direction:C.current}):(e.currentImage.value=e.nextImage.value,e.nextImage.value=e.currentImage.value,e.dispFactor.value=1-e.dispFactor.value,d({direction:C.current*-1,index:o}))))},[L,o,d]),A=(0,t.useCallback)(e=>{_(e.clientX-G.current)},[_]),N=(0,t.useCallback)(()=>{P(!1),V(),document.removeEventListener("pointerup",N),document.removeEventListener("pointermove",A)},[A,V]),we=(0,t.useCallback)(e=>{G.current=e.clientX,P(!0),document.addEventListener("pointermove",A),document.addEventListener("pointerup",N)},[A,N]),be=e=>{switch(e.key){case"ArrowRight":d({direction:1});break;case"ArrowLeft":d({direction:-1});break}};return(0,a.jsxs)("div",{className:i.carousel,onKeyDown:be,...y,children:[(0,a.jsxs)("div",{className:i.content,children:[(0,a.jsxs)("div",{className:i.imageWrapper,"data-dragging":I,onPointerDown:we,style:O({aspectRatio:`${u} / ${l}`}),children:[(0,a.jsx)("div",{"aria-atomic":!0,className:i.canvasWrapper,"aria-live":"polite","aria-label":fe,role:"img",children:(0,a.jsx)("canvas",{"aria-hidden":!0,className:i.canvas,ref:M})}),de&&x&&(0,a.jsx)("img",{"aria-hidden":!0,className:i.placeholder,"data-loaded":S&&!!s,src:x,ref:T,alt:"",role:"presentation"})]}),(0,a.jsx)("button",{className:i.button,"data-prev":!0,"aria-label":"Previous slide",onClick:()=>d({direction:-1}),children:(0,a.jsx)(ye,{})}),(0,a.jsx)("button",{className:i.button,"data-next":!0,"aria-label":"Next slide",onClick:()=>d({direction:1}),children:(0,a.jsx)(Ie,{})})]}),(0,a.jsx)("div",{className:i.nav,children:m.map((e,r)=>(0,a.jsx)("button",{className:i.navButton,onClick:()=>ge(r),"aria-label":`Jump to slide ${r+1}`,"aria-pressed":r===o},e.alt))})]})};function ye(){return(0,a.jsx)("svg",{fill:"currentColor",width:"18",height:"42",viewBox:"0 0 18 42",children:(0,a.jsx)("path",{d:"M18.03 1.375L16.47.125-.031 20.75l16.5 20.625 1.562-1.25L2.53 20.75z"})})}function Ie(){return(0,a.jsx)("svg",{fill:"currentColor",width:"18",height:"42",viewBox:"0 0 18 42",children:(0,a.jsx)("path",{d:"M-.03 1.375L1.53.125l16.5 20.625-16.5 20.625-1.562-1.25 15.5-19.375z"})})}export{xe as Carousel};
