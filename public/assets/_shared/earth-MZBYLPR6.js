import{a as Ae}from"/assets/_shared/chunk-NHXO7TLZ.js";import{A as mU,B as zU,C as kU,D as vU,G as Ue,H as ee,I as Be,J as re,K as Pe,L as Je,M as UU,a as oU,b as dU,c as HU,d as VU,e as DU,h as ZU,j as v,o as jU,r as _U,u as OU,v as wU,w as gU,y as $U,z as IU}from"/assets/_shared/chunk-L256IZSK.js";import{a as WU}from"/assets/_shared/chunk-6HAZSQ7R.js";import{a as MU}from"/assets/_shared/chunk-PEYEMZWK.js";import{a as GU}from"/assets/_shared/chunk-N6K2DFXZ.js";import{a as xU}from"/assets/_shared/chunk-OAGHZG5J.js";import{b as uU,c as lU}from"/assets/_shared/chunk-3GAHIIES.js";import{a as yU,b as EU,d as YU,g as cU,j as y,k as CU}from"/assets/_shared/chunk-F4ODTSJS.js";import{a as Ke,b as NU}from"/assets/_shared/chunk-ZSCARA4Z.js";import{c as sU}from"/assets/_shared/chunk-F3TRQT5X.js";var Re="/assets/_assets/earth-KECVD2W3.glb";var te="/assets/_assets/milkyway-nx-B2LSWIPY.hdr";var Te="/assets/_assets/milkyway-ny-ABSFT437.hdr";var Qe="/assets/_assets/milkyway-nz-L425LJDA.hdr";var se="/assets/_assets/milkyway-px-FERHKW3X.hdr";var Ee="/assets/_assets/milkyway-py-PLXMGDNB.hdr";var ce="/assets/_assets/milkyway-pz-B33EWIJV.hdr";var De="/assets/_assets/milkyway-37ER5DRR.jpg";var U=sU(Ke(),1);var nU=(B,T,s)=>{if(s){if(Math.min(B,T)===B)return T;if(Math.max(B,s)===B)return s}else return Math.max(B,T)===T?B:T;return B};var X={earth:"eI03r",loader:"FgryW",viewport:"jyNGg",canvas:"_1-1Px",labels:"pWKoQ",label:"MSTaL",vignette:"OZkiK",sections:"RoQEw",section:"uBo-5"};var i=sU(NU(),1),KU={x:0,y:0,z:2},LU=(B,T,s)=>B+s*(T-B),ne=B=>Object.keys(B).map(T=>parseFloat(Math.round(B[T]*100)/100).toFixed(2)).join(", "),aU=B=>!B||!B.camera?KU:{x:B.camera[0],y:B.camera[1],z:B.camera[2]},ye=(B,T)=>{let s=(C=0)=>Math.round((C+Number.EPSILON)*100)/100;return s(B?.x)===s(T?.x)&&s(B?.y)===s(T?.y)&&s(B?.z)===s(T?.z)},iU={stiffness:80,damping:40,mass:2,restSpeed:.001,restDelta:.001},FU={stiffness:40,damping:30,mass:2,restSpeed:.001,restDelta:.001},Ye={stiffness:40,damping:30},Le=(0,U.createContext)({}),QB=({position:B=[0,0,0],scale:T=1,hideMeshes:s=[],labels:C=[],className:_,children:O})=>{let[D,w]=(0,U.useState)(!1),[u,W]=(0,U.useState)(!1),[g,eU]=(0,U.useState)(!1),[$,ae]=(0,U.useState)(!1),L=(0,U.useRef)([]),BU=(0,U.useRef)(),rU=(0,U.useRef)(),M=(0,U.useRef)(),Y=(0,U.useRef)(),S=(0,U.useRef)(),R=(0,U.useRef)(),SU=(0,U.useRef)(),bU=(0,U.useRef)(),PU=(0,U.useRef)(),n=(0,U.useRef)(),I=(0,U.useRef)(),o=(0,U.useRef)(),l=GU(M),m=(0,U.useRef)(),JU=(0,U.useRef)(aU(L.current[0])),z=(0,U.useRef)([]),b=(0,U.useRef)(),AU=(0,U.useRef)(),pU=(0,U.useRef)(),RU=(0,U.useRef)(),{width:d,height:tU}=WU(),k=CU(),f=y(0,iU),h=y(0,iU),N=y(0,iU),H=y(0,FU),V=y(0,FU),Z=y(0,FU),G=y(0,Ye),TU=(0,U.useCallback)(()=>{if(!l){cancelAnimationFrame(m.current);return}m.current=requestAnimationFrame(TU);let r=SU.current.getDelta();o.current.update(r),b.current.update(),S.current.render(Y.current,R.current),z.current.forEach(J=>{let{element:t,position:a,sprite:F}=J,E=new v(...a),A=R.current.position.distanceTo(n.current.position),c=R.current.position.distanceTo(F.position)>A;E.project(R.current),E.x=Math.round((.5+E.x/2)*window.innerWidth),E.y=Math.round((.5-E.y/2)*window.innerHeight),t.style.setProperty("--posX",EU(E.x)),t.style.setProperty("--posY",EU(E.y)),c?t.dataset.occluded=!0:t.dataset.occluded=!1})},[l]);(0,U.useEffect)(()=>{RU.current=!0;let{innerWidth:r,innerHeight:J}=window;S.current=new OU({canvas:M.current,antialias:!1,alpha:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),S.current.setPixelRatio(1),S.current.outputColorSpace=DU,S.current.toneMapping=oU,R.current=new jU(54,r/J,.1,100),R.current.position.x=JU.current.x,R.current.position.y=JU.current.y,R.current.position.z=JU.current.z,R.current.lookAt(0,0,0),f.set(R.current.position.x,!1),h.set(R.current.position.y,!1),N.set(R.current.position.z,!1),Y.current=new wU,SU.current=new mU,PU.current=new kU;let t=new IU(2236962,.05),a=new $U(16777215,1.5);a.position.set(3,0,1);let F=[t,a];return F.forEach(E=>Y.current.add(E)),b.current=new vU(R.current,M.current),b.current.enableZoom=!1,b.current.enablePan=!1,b.current.enableDamping=!1,b.current.rotateSpeed=.5,()=>{RU.current=!1,cancelAnimationFrame(m.current),Je(F),re(Y.current),Pe(S.current)}},[]),(0,U.useEffect)(()=>{let r=()=>{W(!0),f.stop(),h.stop(),N.stop()},J=()=>{f.set(R.current.position.x,!1),h.set(R.current.position.y,!1),N.set(R.current.position.z,!1),W(!1)};return b.current.addEventListener("start",r),b.current.addEventListener("end",J),()=>{b.current.removeEventListener("start",r),b.current.removeEventListener("end",J)}},[f,h,N]),(0,U.useEffect)(()=>{if(!D)return;let r=UU("Chunk",n.current),J=UU("Atmosphere",n.current),t=(e,Q)=>{R.current.position[e]=Q},a=f.on("change",e=>t("x",e)),F=h.on("change",e=>t("y",e)),E=N.on("change",e=>t("z",e)),A=(e,Q)=>{r.position[e]=Q},x=H.on("change",e=>A("x",e)),c=V.on("change",e=>A("y",e)),p=Z.on("change",e=>A("z",e)),P=G.on("change",e=>{J.material.opacity=e});return()=>{a(),F(),E(),x(),c(),p(),P()}},[f,h,N,H,V,Z,D,G]),(0,U.useEffect)(()=>{d<=yU.tablet&&(b.current.enabled=!1)},[d]),(0,U.useEffect)(()=>{if(D)return;let r=new Ue,J=new _U(S.current);J.compileCubemapShader();let t=async()=>{let A=await ee.loadAsync(Re);n.current=A.scene,I.current=A.animations,o.current=new zU(n.current),o.current.timeScale=.1,n.current.traverse(async x=>{let{material:c,name:p}=x;p==="Atmosphere"&&(c.alphaMap=c.map),c&&await S.current.initTexture(c)}),n.current.position.x=B[0],n.current.position.y=B[1],n.current.position.z=B[2],n.current.scale.x=T,n.current.scale.y=T,n.current.scale.z=T},a=async()=>{let A=await r.loadAsync([te,Te,Qe,se,Ee,ce]);A.magFilter=HU,AU.current=J.fromCubemap(A),J.dispose(),await S.current.initTexture(AU.current.texture)},F=async()=>{let A=await Be.loadAsync(De);A.mapping=dU,A.colorSpace=DU,Y.current.background=A,await S.current.initTexture(A)},E=async()=>{await Promise.all([F(),a(),t()]),n.current.traverse(({material:A})=>{A&&(A.envMap=AU.current.texture,A.needsUpdate=!0)}),RU.current&&w(!0)};(0,U.startTransition)(()=>{E(),setTimeout(()=>{ae(!0)},1e3)})},[D,B,T]),(0,U.useEffect)(()=>(D&&!pU.current&&(Y.current.add(n.current),pU.current=!0),D&&l&&(eU(!0),TU()),()=>{cancelAnimationFrame(m.current)}),[TU,l,D]),(0,U.useEffect)(()=>{D&&(rU.current.innerHTML="",z.current=C.map(r=>{let J=document.createElement("div");J.classList.add(X.label),J.dataset.hidden=!0,J.style.setProperty("--delay",`${r.delay||0}ms`),J.textContent=r.text,rU.current.appendChild(J);let t=new gU;return t.position.set(...r.position),t.scale.set(60,60,1),{element:J,...r,sprite:t}}))},[C,D]),(0,U.useEffect)(()=>{S.current.setSize(d,tU),R.current.aspect=d/tU,R.current.updateProjectionMatrix()},[d,tU]),(0,U.useEffect)(()=>{let r=M.current,J=t=>{let{innerWidth:a,innerHeight:F}=window,E=ne(R.current.position);console.info({cameraPosition:E}),bU.current=new ZU(t.clientX/a*2-1,-(t.clientY/F)*2+1),PU.current.setFromCamera(bU.current,R.current);let A=PU.current.intersectObjects(Y.current.children,!0);if(A.length>0){let x=ne(A[0].point);console.info({clickPosition:x})}};return()=>{r.removeEventListener("click",J)}},[]);let qU=(0,U.useCallback)(()=>{if(!BU.current)return;let{offsetTop:r}=BU.current,{innerHeight:J}=window,t=window.scrollY-r,a,F=c=>{let p=L.current[c].meshes;n.current.traverse(P=>{let{name:e}=P,Q=UU("Chunk",n.current),K=p?.includes(e),j=s?.includes(e);if(K)if(e==="Atmosphere")P.visible=!0,G.set(1);else if(e==="Chunk"){let q=new v(-.4,.4,.4);P.visible=!0,k?P.position.set(...q.toArray()):(H.set(q.x),V.set(q.y),Z.set(q.z))}else e==="EarthFull"&&Q.visible?P.visible=!1:P.visible=!0;else if(j&&!K)if(e==="Atmosphere")G.set(0);else if(e==="Chunk"){let q=new v(0,0,0);ye(q,Q.position)&&(P.visible=!1),H.set(q.x),V.set(q.y),Z.set(q.z)}else e==="EarthPartial"&&Q.visible?P.visible=!0:P.visible=!1})},E=c=>{let p=L.current[c].animations;k||(I.current.forEach((P,e)=>{p.find(Q=>Q.includes(e.toString()))||o.current.clipAction(P).reset().stop()}),I.current.length&&L.current[c].animations&&p.forEach(P=>{let e=P.split(":"),Q=I.current[Number(e[0])],K=o.current.clipAction(Q);(!e[1]||e[1]!=="loop")&&(K.clampWhenFinished=!0,K.loop=VU),K.play()}))},A=c=>{z.current.forEach(P=>{P.hidden&&(P.element.dataset.hidden=!0,P.element.setAttribute("aria-hidden",!0))}),L.current[c].labels.forEach(P=>{z.current.filter(Q=>Q.text===P).forEach(Q=>{Q.element.dataset.hidden=!1,Q.element.setAttribute("aria-hidden",!1)})})};requestAnimationFrame(()=>{let c=L.current.length-1,p=Math.floor(t/J),P=nU(p,0,c),e=L.current[P],Q=L.current[P+1],K=aU(e)||KU,j=aU(Q)||KU,q=(t-J*P)/J,QU=nU(q,0,1),XU=LU(K.x,j.x,QU),fU=LU(K.y,j.y,QU),hU=LU(K.z,j.z,QU);if(a!==K&&L.current.length&&e&&(F(P),E(P),A(P)),a=K,!u){if(k){R.current.position.set(XU,fU,hU);return}f.set(XU),h.set(fU),N.set(hU)}})},[f,h,N,H,V,Z,u,s,G,k]);(0,U.useEffect)(()=>{let r=Ae(qU,100);return D&&l&&window.addEventListener("scroll",r),()=>{window.removeEventListener("scroll",r)}},[qU,l,D,G]);let ie=(0,U.useCallback)(r=>{L.current=[...L.current,r]},[]),Fe=(0,U.useCallback)(r=>{L.current=L.current.filter(J=>J!==r)},[]);return(0,i.jsx)(Le.Provider,{value:{registerSection:ie,unregisterSection:Fe},children:(0,i.jsxs)("div",{className:cU(X.earth,_),ref:BU,children:[(0,i.jsxs)("div",{className:X.viewport,children:[(0,i.jsx)("canvas",{className:X.canvas,"data-visible":D&&g,"data-grabbing":u,ref:M}),(0,i.jsx)("div",{className:X.labels,"aria-live":"polite",ref:rU}),(0,i.jsx)("div",{className:X.vignette})]}),(0,i.jsx)("div",{className:X.sections,children:O}),(0,i.jsx)(lU,{unmount:!0,in:!D&&$,timeout:YU(xU.base.durationL),children:r=>(0,i.jsx)(MU,{className:X.loader,"data-visible":r,children:(0,i.jsx)(uU,{})})})]})})},sB=(0,U.memo)(({children:B,scrim:T,scrimReverse:s,className:C,camera:_=[0,0,0],animations:O=[],meshes:D=[],labels:w=[]})=>{let{registerSection:u,unregisterSection:W}=(0,U.useContext)(Le),g=(0,U.useRef)(),eU=JSON.stringify(O)+JSON.stringify(_)+JSON.stringify(w)+JSON.stringify(D);return(0,U.useEffect)(()=>{let $={camera:_,animations:O,meshes:D,labels:w,sectionRef:g};return u($),()=>{W($)}},[eU,u,W]),(0,i.jsx)("div",{className:cU(X.section,C),"data-scrim":T,"data-scrim-reverse":s,ref:g,children:B})});export{QB as Earth,sB as EarthSection};
